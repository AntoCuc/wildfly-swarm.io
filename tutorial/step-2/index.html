<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="WildFly Swarm Official Website"><link rel="icon" href="/favicon.ico"><link rel="alternate" type="application/rss+xml" title="RSS Feed for wildfly-swarm.io" href="/rss.xml"><title>WildFly Swarm</title><link rel="stylesheet" media="screen" href="/lib/bootstrap/css/bootstrap.min.css"><link rel="stylesheet" media="screen" href="/css/site.css"><link rel="stylesheet" media="screen" href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,800"><link rel="stylesheet" media="screen" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" media="screen" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/styles/default.min.css"></head><body><nav class="navbar navbar-default navbar-fixed-top"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar" class="navbar-toggle collapsed"><span class="sr-only"></span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand"><img src="/images/swarm_icon_32x32.png" class="icon"><span>WildFly Swarm</span></a></div><div id="navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav"><li><a href="/generator" class="hidden-xs hidden-sm hidden-md">Generator<span class="badge">new!</span></a></li><li><a href="/archive">Blog</a></li><li><a href="/documentation">Documentation</a></li><li><a href="/downloads">Downloads</a></li><li><a href="/community">Community</a></li><li><a href="/resources">Resources</a></li><li><a href="https://github.com/wildfly-swarm/wildfly-swarm" class="hidden-xs hidden-sm hidden-md">GitHub</a></li></ul></div></div></nav><section class="section"><div class="container"><div class="row"><div class="col-sm-8"><h1 id="_step_2_right_size_your_runtime" class="sect0">Step 2: Right-size your runtime</h1>
<div class="paragraph">
<p>In this activity we bring Swarm to the table. We look the basic concepts for building Swarm services and discover how to build and run it. This includes basic configuration options, like bind address, ports and logging.</p>
</div>
<div class="paragraph">
<p>In the previous step all services have been deployed to a single JVM (WildFly). Now we separate the <code>order</code>, <code>catalog</code> and <code>user</code> services and run each in their own JVM (could be thought of as another  another host).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/step-2.png" alt="step 2.png">
</div>
<div class="title">Figure 1. Each service within a separate JVM</div>
</div>
<div class="sect1">
<h2 id="_concepts">Concepts</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Swarm plugin</p>
</li>
<li>
<p>Uberjar</p>
</li>
<li>
<p>Fraction auto discovery</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tasks">Tasks</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Add a dependency to the Swarm BOM  to the top level pom.xml, so all modules inherit the Swarm dependencies if needed.
This includes the Swarm maven plugin.</p>
</li>
<li>
<p>Prepare each service module (pom.xml) to include the Swarm maven plugin (i.e. <code>order</code>, <code>user</code>, <code>catalog</code>)</p>
</li>
<li>
<p>Do a top level build (<code>mvn clean install</code>). This will create the <code>-swarm.jar</code> artifacts in all modules that youâ€™ve added the Swarm plugin.</p>
</li>
<li>
<p>Run each service from the command-line <code>java -jar &lt;service-name&gt;-swarm.jar -Dswarm.bind.address=&lt;PUBLIC_IP&gt; -Dswarm.port.offset=&lt;PORT_OFFSET&gt;</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Make sure you explicitly bind the services to <code>&lt;PUBLIC_IP&gt;</code>, i.e.:
<code>java -jar &lt;service-name&gt;-swarm.jar -Dswarm.bind.address=&lt;PUBLIC_IP&gt; -Dswarm.port.offset=&lt;PORT_OFFSET&gt;</code>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_outcome">Outcome</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Swarm packages the required runtime components and your service into a distinct .jar file</p>
</li>
<li>
<p>You can each run service separately, without deploying it on WildFly.</p>
</li>
<li>
<p>The user interface, remaining on WildFly, still works as expected.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_documentation">Documentation</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://wildfly-swarm.gitbooks.io/wildfly-swarm-users-guide/content/getting-started/basics.html">Swarm Basics</a></p>
</li>
<li>
<p><a href="https://wildfly-swarm.gitbooks.io/wildfly-swarm-users-guide/content/getting-started/war-applications.html">WAR Packaging</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_alternative_activities">Alternative activities</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><code>mvn -Dswarm.bind.address=&lt;PUBLIC_IP&gt; wildfly-swarm:run</code></p>
</li>
<li>
<p>Inspect the build process or resulting jar to see what things get packaged</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>
<div class="row">
  <div class="col-md-6">
<a href="/tutorial/step-1" class="btn btn-primary"><i class="fa fa-chevron-left" aria-hidden="true"></i> Step 1: Services the 'old' way</a>
  </div>
  <div class="col-md-6">
  <a href="/tutorial/step-3" class="btn btn-primary">Step 3: Container API, Fractions and Deployments
<i class="fa fa-chevron-right" aria-hidden="true"></i></a>
  </div>
</div>
</p>
</div>
</div>
</div></div><div class="col-sm-3 col-sm-offset-1"><div class="sidebar panel panel-default"><ul><li><a href="/tutorial">Introduction</a></li><li><a href="/tutorial/sources">Source Code</a></li><li><a href="/tutorial/example-app">Example Application</a></li><li><a href="/tutorial/prerequisites">Prerequisites</a></li><li><a href="/tutorial/step-0">Step 0: A manageable codebase</a></li><li><a href="/tutorial/step-1">Step 1: Services the old way</a></li><li><a href="/tutorial/step-2">Step 2: Right-size your runtime</a></li><li><a href="/tutorial/step-3">Step 3: Container API, Fractions and Deployments</a></li><li><a href="/tutorial/step-4">Step 4: Environment specific configuration</a></li><li><a href="/tutorial/step-5">Step 5: Fault tolerance and resilience</a></li><li><a href="/tutorial/step-6">Step 6: Load balancing and failover</a></li><li><a href="/tutorial/toxy">Appendix A: Fault-injection proxy</a></li><li><a href="/tutorial/hystrix">Appendix B: Hystrix Dashboard</a></li><li class="last"><a href="/tutorial/reading">Reading on Microservices </a></li></ul></div></div></div><div class="row"><div class="col-sm-8"><div id="disqus_thread"><script> var disqus_config = function () { this.page.url = PAGE_URL; this.page.identifier = PAGE_IDENTIFIER;}; (function() { var d = document, s = d.createElement('script'); s.src = '//wildflyswarm.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); 
</script></div></div></div></div></section><div class="container"><div class="footer"><div class="col-sm-6"><p class="text-center">&copy; Copyright 2016 <a href="http://redhat.com">Red Hat, Inc.</a> | WildFly Swarm is Open Source Software</p></div><div class="col-sm-6"><p class="text-center"><span>We rely on the
<a href='http://www.ej-technologies.com/products/jprofiler/overview.html'>
Java profiler from EJ Technologies
</a><br/>
<img src='https://www.ej-technologies.com/images/product_banners/jprofiler_medium.png'/></span></p></div></div></div><script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="/lib/bootstrap/js/bootstrap.min.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-83419890-2', 'auto');
ga('send', 'pageview');

ga('create', 'UA-6435340-8', 'auto');
ga('send', 'pageview');

</script><script src="//www.redhat.com/j/s_code.js"></script><script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script><script>(function() {

  // Load the path name, without it's inital /
  var arr = location.pathname.substr(1, location.pathname.length)
      .toLowerCase().split('/');

  // If the path ends in index.html or whitespace, trim the array
  if (arr[arr.length - 1] == "index.html" || arr[arr.length - 1] == "" ) {
     arr.pop();
  }

  /*
  * Assign values to Adobe Analytics properties
  */
  s.channel = "wildflyswarm| {{Channel}}" // The channel is our top level classification
  s.server = "wildflyswarm" // The server is ???
  s.pageName = "wildflyswarm| {{Channel}} | " + (arr[arr.length -1] || "homepage"); // pageName is wildflyswarm | <Channel> | {page_name}. {page_name} has index.html removed
  s.prop2 = s.eVar22 = "en"; // prop2/eVar22 is the ISO 639-1 language code
  s.prop4 = s.eVar23 = encodeURI(location.search); //prop4/eVar23 is the query string of the page

  // Pad the array as needed, so we can shift away later
  for (var i = arr.length; i < 3; i++) {
      arr[i] = "";
  }

  s.prop14 = s.eVar27 = arr.shift(); // prop14/eVar27 is the first minor section (normally /{minor_section_1})
  s.prop15 = s.eVar28 = arr.shift(); // prop15/eVar28 is the second minor section (normally /a/{minor_section_2})
  s.prop16 = s.eVar29 = arr.shift(); // prop16/eVar29 is the third minor section (normally /a/b/{minor_section_3})
  s.prop21 = s.eVar18 = encodeURI(location.hostname+location.pathname).toLowerCase(); // prop21/eVar18 is the URL, less any query strings or fragments

  })();
</script><script src="//www.redhat.com/assets/js/tracking/rh_omni_footer.js"></script><script>(function() {
  hljs.initHighlightingOnLoad();
})();
</script></body></html>